# üìö AI Services Librarian

The librarian functionality in Fenec is designed to act as an intermediary between user queries and the vector database (ChromaDB) containing code summaries. This feature aims to improve the relevance of retrieved information by generating appropriate database queries based on user input.

> **‚ö†Ô∏è Note:** The librarian functionality is currently under active development and may not perform optimally at this time. We are exploring various approaches to enhance its effectiveness and reliability.

> **NOTE:** This is automatically handled by the Fenec API, so you don't need to interact with the Summarizer logic directly unless you want more granular control or to perform custom operations for testing, learning about how Fenec works, or extending Fenec's functionality.

## üåü Current Features

-   üîç Generation of relevant queries for ChromaDB based on user input
-   üß† Use of OpenAI's language models for query generation
-   üîÄ Integration with ChromaDB for retrieving code summaries
-   üìù Customizable prompts for query generation

## üöß Under Development

Please be aware that the librarian functionality is a work in progress and may undergo significant changes. Current limitations include:

-   Inconsistent query generation
-   Potential misinterpretation of user intent
-   Limited integration with other Fenec components

## üîÆ Future Directions

We are actively exploring ways to improve the librarian functionality, including:

1. **Structured Output:** Enhancing the output format to provide more structured and consistent output.

2. **Standalone Library:** Considering extracting this functionality into its own library for broader use and easier maintenance.

3. **Alternative Solutions:** Investigating the use of established libraries like LangChain, which could provide a more robust and feature-rich solution for similar purposes.

4. **Simplified Interface:** Developing a streamlined interface within Fenec that could leverage either our custom solution or integrate with external libraries like LangChain.

## üöÄ Current Usage

Despite its developmental status, you can still experiment with the librarian functionality:

```python
from fenec import Fenec
from fenec.databases.chroma import ChromaCollectionManager
from fenec.ai_services.librarian import ChromaLibrarian

# Assuming Fenec is already initialized and the project is processed
# Initialize the ChromaCollectionManager
chroma_manager = ChromaCollectionManager(collection_name="my_collection")

# Create a ChromaLibrarian instance
librarian = ChromaLibrarian(collection_manager=chroma_manager)

# Query the librarian
result = librarian.query_chroma("How does Fenec handle code parsing?")

if result:
    for doc in result.documents:
        print(doc)
else:
    print("No relevant information found.")
```

### Customizing Prompts

You can customize the prompts used by the ChromaLibrarian to generate queries. The default prompts are defined in `fenec.ai_services.librarian.prompts.chroma_librarian_prompts`:

```python
from fenec.ai_services.librarian import (
    DEFAULT_CHROMA_LIBRARIAN_PROMPT,
    DEFAULT_CHROMA_LIBRARIAN_SYSTEM_PROMPT
)

# Modify the prompts as needed
custom_system_prompt = """
Your custom system prompt here.
"""

custom_prompt = """
Your custom prompt template here.
Include {user_question} and {queries_count} placeholders.
"""

# Use custom prompts when creating a ChromaLibrarian instance
librarian = ChromaLibrarian(
    collection_manager=chroma_manager,
    system_prompt=custom_system_prompt,
    prompt_template=custom_prompt
)
result = librarian.query_chroma("How does Fenec handle code parsing?")

# Note the way the `query_chroma` method is set up right now the queries generated by the librarian are automatically printed.
```

## ü§ù Contributing

We welcome ideas and contributions to improve the librarian functionality! If you have suggestions or want to contribute, please check our [Contributing Guidelines](../../CONTRIBUTING.md) and consider opening an issue or submitting a pull request.

## üó∫Ô∏è Roadmap

The future of the librarian functionality is open to community input and evolving project needs. Some ideas under consideration include:

-   Tests, tests, tests, tests, tests! - Due to a rush to get Fenec out the door, we have a lot of untested code.
-   Improving query generation accuracy
-   Enhancing integration with other Fenec components
-   Exploring hybrid approaches combining custom solutions with established libraries

For a more comprehensive view of our plans, please refer to our [Roadmap](../../ROADMAP.md).

We appreciate your patience and feedback as we work to refine this feature and make Fenec more powerful and user-friendly!
